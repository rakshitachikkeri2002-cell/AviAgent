<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	<audio id="notificationSound" src="notification.mp3" preload="auto"></audio>

	<h1>Avi agent</h1>
   <script type='text/javascript'>
	console.log("Live Agent script is loaded!");
	console.log('fbrhjfbrju');
	console.log('Hiiii')
	function initEmbeddedMessaging() {
		try {
			embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'

			embeddedservice_bootstrap.init(
				'00DgL00000BUy5F',
				'Avi_Messaging_Channel',
				'https://orgfarm-d116344813-dev-ed.develop.my.site.com/ESWAviMessagingChannel1767592713786',
				{
					scrt2URL: 'https://orgfarm-d116344813-dev-ed.develop.my.salesforce-scrt.com'
				}
			);
			embeddedservice_bootstrap.settings.onMessageReceived = function(message) {
            if(message.from === 'agent' && isTabHidden) {
                new Notification("New message from Agent", {
                    body: message.text,
                    icon: "chat-icon.png"
                });
            }
        };
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};
</script>
<script type='text/javascript' src='https://orgfarm-d116344813-dev-ed.develop.my.site.com/ESWAviMessagingChannel1767592713786/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>


<script>

  console.log("CUSTOM JS LOADED FROM GITHUB");
  let isTabHidden = false;

document.addEventListener("visibilitychange", function() {
    isTabHidden = document.hidden;
});
if (Notification.permission !== "granted") {
    Notification.requestPermission();
}
function onNewMessage(message) {
    // Check if message is from the agent
    if(message.from === 'agent' && isTabHidden){
        // Play sound
        document.getElementById('notificationSound').play();
    }

    // Display message in chat as usual
    displayMessage(message);
}
if (isTabHidden && Notification.permission === "granted") {
    new Notification("New message from Agent", {
        body: message.text,
        icon: "chat-icon.png"
    });
}
if (Notification.permission !== "granted") {
    Notification.requestPermission();
}


</script>

</body>
</html>